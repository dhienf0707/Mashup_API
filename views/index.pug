extends layout

block map
    script.
        let map, infoWindow;
        function initMap(currentLocation, lat, lng) {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 42.4778, lng: -70.9495},
                zoom: 10
            });
            infoWindow = new google.maps.InfoWindow;
            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                infoWindow.setPosition(pos);
                infoWindow.setContent("Current Location")
                infoWindow.open(map);
                map.setCenter(pos);
                }, function() {
                handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }
            markers = !{JSON.stringify(locations)};
            // iterate through json location and mark it on the map
            for(let i = 0; i < markers.length; i++) {
                addMarker(markers[i]);
            }

        }

        function addMarker(props) {
            let marker = new google.maps.Marker({
                position: props.coords,
                map: map,
            });
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                                    'Error: The Geolocation service failed.' :
                                    'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }